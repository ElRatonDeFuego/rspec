include::../description.adoc[]

== Noncompliant Code Example

https://docs.microsoft.com/en-us/dotnet/api/system.security.cryptography.aesmanaged?view=netframework-4.8[AesManaged] object with insecure mode:

[source,csharp]
----
AesManaged aes = new AesManaged
{
  KeySize = 128,
  BlockSize = 128,
  Mode = CipherMode.ECB, 
  Padding = PaddingMode.PKCS7
}; // Noncompliant
----

https://docs.microsoft.com/en-us/dotnet/api/system.security.cryptography.rsacryptoserviceprovider?view=netframework-4.8[RSACryptoServiceProvider] object without OAEP padding:

[source,csharp]
----
RSACryptoServiceProvider RSA1 = new RSACryptoServiceProvider();
encryptedData = RSA1.Encrypt(dataToEncrypt, false); // Noncompliant: OAEP Padding is not used (second parameter set to false)
----

== Compliant Solution

AES with GCM mode with https://docs.microsoft.com/en-us/dotnet/api/system.security.cryptography.aesgcm?view=netcore-3.0[AesGcm] object: 

[source,csharp]
----
var aesGcm = new AesGcm(key);
----

AES with GCM mode with https://www.bouncycastle.org/[bouncycastle] library:
[source,csharp]
----
GcmBlockCipher blockCipher = new GcmBlockCipher(new AesEngine());
blockCipher.Init(true, new AeadParameters(new KeyParameter(secretKey), 128, iv, null));
----

If AES with GCM mode is not available, use AES CBC without padding or chose an alternative cipher mode: 

[source,csharp]
----
AesManaged aesCBC = new AesManaged
{
  KeySize = 128,
  BlockSize = 128,
  Mode = CipherMode.CBC,
  Padding = PaddingMode.None
};

AesManaged aesCTS = new AesManaged
{
  KeySize = 128,
  BlockSize = 128,
  Mode = CipherMode.CTS
};
----

RSA with OAEP padding with https://docs.microsoft.com/en-us/dotnet/api/system.security.cryptography.rsacryptoserviceprovider?view=netframework-4.8[RSACryptoServiceProvider] object: 

[source,csharp]
----
RSACryptoServiceProvider RSA2 = new RSACryptoServiceProvider();
encryptedData = RSA2.Encrypt(dataToEncrypt, true);
----

include::../see.adoc[]

ifdef::env-github,rspecator-view[]

'''
== Implementation Specification
(visible only on this page)

include::message.adoc[]

include::highlighting.adoc[]

'''
== Comments And Links
(visible only on this page)

include::comments-and-links.adoc[]
endif::env-github,rspecator-view[]
